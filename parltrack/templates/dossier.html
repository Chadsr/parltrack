{% extends "base.html" %}
{% block scripts %}
<script type="text/javascript">
     $(document).ready(function() {
       $('#ranking_date').click(function() {
        if($(this).attr('value') == 'DD/MM/YYYY') $(this).attr('value', '');
       });
       $('#ranking_form').submit(function() {
        window.location = '/meps/'+$('#ranking_date').attr('value');
        return false;
       });
       $('.has_summary').click(function() {
        $(this).next().toggleClass('hidden');
       });
     });
    </script>
{% endblock %}
{% block content %}
<h2>{{ dossier.procedure.reference }}</h2>
<p>{{dossier.procedure.title}}</p>
<p><strong>{{dossier.procedure.stage_reached}}</strong></p>
<ul>{%for sub in dossier.procedure.subjects%}<li>{{sub}}</li>{%endfor%}</ul>
<h3>Legal Basis</h3>
<ul>{%for sub in dossier.procedure.legal_basis%}<li>{{sub}}</li>{%endfor%}</ul>
{% if dossier.procedure.agents %}
<h3>Committees</h3>
<ul>{%for agent in dossier.procedure.agents%}
   <li>
     {%if agent.responsible%}
        <strong>{{agent.commitee}}</strong>
        {%if dossier.procedure.dossier_of_the_committee %}<a href="/doc/{{dossier.procedure.dossier_of_the_committee}}">{{dossier.procedure.dossier_of_the_committee}}</a>{%endif%}
     {%else%}
        {{agent.commitee}}
     {%endif%}
     {%if agent.name%}{{agent.name}}{%endif%}
     {%if agent.group%}{{agent.group}}{%endif%}
   </li>
  {%endfor%}
</ul>
{%endif%}
<h3>Activites</h3>
<ul>{%for act in dossier.activities%}
   <li>
     {%if act.date%}{{act.date}}{%endif%}
     {%if act.title%}{{act.title}}{%endif%}
     {%if act.type%}{{act.type}}{%endif%}
     <ul>
     {%for agent in act.actors%}
        {%if agent.function == "MEP" %}
           <li>
             {%if agent.responsible%}
                <strong>{{agent.commitee}}</strong>
                {%if dossier.procedure.dossier_of_the_committee %}<a href="/doc/{{dossier.procedure.dossier_of_the_committee}}">{{dossier.procedure.dossier_of_the_committee}}</a>{%endif%}
             {%else%}
                {{agent.commitee}}
             {%endif%}
             {%if agent.name%}<a href="/mep/{{agent.name}}">{{agent.name}}</a>{%endif%}
             {%if agent.group%}{{agent.group}}{%endif%}
           </li>
        {%endif%}
        {%if agent.body == "CSL" %}
           <li>
           </li>
        {%endif%}
     {%endfor%}
     </ul>
     <div>
     {%for doc in act.documents%}
        {%if doc.url %}
          {%if doc.summary%}
             <a class="has_summary">{{doc.title}}</a>
             <div class="hidden" id="{{doc.title}}-summary">
               {%for line in doc.summary %}
               {{line|safe}}
               {%endfor%}
             </div>
          {%else%}
             {{doc.title}}
          {%endif%}
        <a href="{{doc.url}}">[↓]</a>
        {%endif%}
     {%endfor%}
     </div>
   </li>
  {%endfor%}
</ul>
<h3>Documents</h3>
<ul>
{%for doc in dossier.docs%}
  {%if doc.url %}
    <li>
    {%if doc.summary%}
       <a class="has_summary">{{doc.title}}</a>
       {{doc.type}}
       <div class="hidden" id="{{doc.title}}-summary">
         {%for line in doc.summary %}
         {{line|safe}}
         {%endfor%}
       </div>
    {%else%}
       {{doc.title}} {{doc.type}}
    {%endif%}
    <a href="{{doc.url}}">[↓]</a>
    </li>
  {%endif%}
{%endfor%}
</ul>
{% if dossier.votes %}
<h3>Votes</h3>
{%for vote in dossier.votes%}
<h4>{{vote.title}}</h4>
  <table class="votes">
     <thead>
        <tr>
          <td>Position</td>
          <td>Total</td>
          {% for g in vote.groups|sort %}
            {% if g not in ['correctional', 'total']%}
            <td>{{g}}</td>
            {%endif%}
          {%endfor%}
          <td>correctional</td>
        </tr>
     </thead>
     <tbody>
       <tr>
         <td>For</td>
         <td>{{vote.For.total}}</td>
         {% for k,v in vote.For.items() %}
            {% if k not in ['correctional', 'total']%}
            <td>{{v|length}}</td>
            {%endif%}
         {%endfor%}
         {% if 'correctional' in vote.For%}
           <td>{{vote.For.correctional|length}}</td>
         {%endif%}
       </tr>
       <tr>
         <td>Against</td>
         <td>{{vote.Against.total}}</td>
         {% for k,v in vote.Against.items() %}
            {% if k not in ['correctional', 'total']%}
            <td>{{v|length}}</td>
            {%endif%}
         {%endfor%}
         {% if 'correctional' in vote.Against%}
           <td>{{vote.Against.correctional|length}}</td>
         {%endif%}
       </tr>
       <tr>
         <td>Abstain</td>
         <td>{{vote.Abstain.total}}</td>
         {% for k,v in vote.Abstain.items() %}
            {% if k not in ['correctional', 'total']%}
            <td>{{v|length}}</td>
            {%endif%}
         {%endfor%}
         {% if 'correctional' in vote.Abstain%}
           <td>{{vote.Abstain.correctional|length}}</td>
         {%endif%}
       </tr>
     </tbody>
  </table>
{%endfor%}
{% endif %}

{{dossier}}
{% endblock %}
